DROP TABLE IF EXISTS tblMember
DROP TABLE IF EXISTS tblNonFicBook
DROP TABLE IF EXISTS tblFicBook
DROP TABLE IF EXISTS tblStore
DROP TABLE IF EXISTS tblEvents
DROP TABLE IF EXISTS tblOrder

create table tblMember (
	memberID INT PRIMARY KEY NOT NULL IDENTITY (1, 1),
	memTypeID INT NOT NULL,
	title NVARCHAR (5) NOT NULL,
	firstName NVARCHAR (30) NOT NULL,
	surname NVARCHAR (30) NOT NULL,
	dob DATE NOT NULL,
	email NVARCHAR (80) NOT NULL,
	passwordHAsh binary(64) NOT NULL,
	passwordSalt uniqueidentifier NOT NULL,
	dayJoined DATE NOT NULL DEFAULT GETDATE(),
	accountAge AS DATEDIFF(DAY, dayJoined, GETDATE()),
	readingList BIT NOT NULL DEFAULT 1,
	amountOfStamps INT NOT NULL
);

CREATE TABLE tblNonFicBook (
	nonFicBookID INT PRIMARY KEY NOT NULL IDENTITY (1, 1),
	title NVARCHAR (150) NOT NULL,
	authorFirstname NVARCHAR (30) NOT NULL,
	authorSurname NVARCHAR (30) NOT NULL,
	pageCount INT NOT NULL DEFAULT '1',
	publishDate DATE NOT NULL,
	synopsis NVARCHAR (500) NOT NULL DEFAULT 'No Info',
	price DECIMAL (4,2) NOT NULL DEFAULT '0.00',
	edition INT NOT NULL DEFAULT 1,
	topic NVARCHAR (20) NOT NULL CONSTRAINT NFtopic CHECK (topic = 'Computing' OR topic = 'Science' OR topic = 'History' OR topic = 'Politics' OR topic = 'Humour') 
);

CREATE TABLE tblFicBook (
	FicBookID INT PRIMARY KEY NOT NULL IDENTITY (1, 1),
	title NVARCHAR (150) NOT NULL,
	authorFirstname NVARCHAR (30) NOT NULL,
	authorSurname NVARCHAR (30) NOT NULL,
	pageCount INT NOT NULL DEFAULT '1',
	publishDate DATE NOT NULL,
	synopsis NVARCHAR (500) NOT NULL DEFAULT 'No Info',
	price DECIMAL (4,2) NOT NULL DEFAULT '0.00',
	genre NVARCHAR (20) NOT NULL CONSTRAINT Fgenre CHECK (genre = 'Classic' OR genre = 'Crime' OR genre = 'Horror' OR genre = 'Fantasy' OR genre = 'Romance')
);

CREATE TABLE tblStore (
	storeID INT PRIMARY KEY NOT NULL IDENTITY (1, 1),
	streetAddress NVARCHAR (30) NOT NULL,
	city NVARCHAR (20) NOT NULL,
	postcode NVARCHAR (8) NOT NULL,
	openTime TIME NOT NULL DEFAULT ('08:00:00'),
	closeTime TIME NOT NULL DEFAULT ('19:00:00'),
	cafe BIT NOT NULL DEFAULT 0,
	disableAccess BIT NOT NULL DEFAULT 0,
	toilets BIT NOT NULL DEFAULT 0,
	wifi BIT NOT NULL DEFAULT 0,
	telephone NVARCHAR(15) NOT NULL
);

CREATE TABLE tblEvents (
	eventID INT PRIMARY KEY NOT NULL IDENTITY (1, 1),
	storeID INT NOT NULL FOREIGN KEY REFERENCES tblStore(storeID) ON DELETE NO ACTION ON UPDATE CASCADE,
	nonFicBookID INT FOREIGN KEY REFERENCES tblNonFicBook(nonFicBookID) ON DELETE NO ACTION ON UPDATE NO ACTION,
	ficBookID INT FOREIGN KEY REFERENCES tblficBook(ficBookID) ON DELETE NO ACTION ON UPDATE NO ACTION,
	eventName NVARCHAR (100) NOT NULL,
	eventDate DATE NOT NULL,
	host NVARCHAR (50) NOT NULL,
	ticketPrice DECIMAL NOT NULL,
	ticketAvailable INT NOT NULL
);

CREATE TABLE tblOrder (
	orderID INT PRIMARY KEY NOT NULL IDENTITY (1001, 1),
	nonFicBookID INT FOREIGN KEY REFERENCES tblNonFicBook(nonFicBookID) ON DELETE NO ACTION ON UPDATE NO ACTION,
	ficBookID INT FOREIGN KEY REFERENCES tblficBook(ficBookID) ON DELETE NO ACTION ON UPDATE NO ACTION,
	memberID INT NOT NULL FOREIGN KEY REFERENCES tblmember(memberID) ON DELETE NO ACTION ON UPDATE NO ACTION,
	storeID INT NOT NULL FOREIGN KEY REFERENCES tblStore(storeID) ON DELETE NO ACTION ON UPDATE CASCADE,
	discount DECIMAL (4,2) NOT NULL DEFAULT '0.00',
	total DECIMAL (4,2) NOT NULL DEFAULT '0.00',
	orderDate DATE NOT NULL DEFAULT GETDATE(),
	collectionDate AS DATEADD(DAY, 2, orderDate),
);


